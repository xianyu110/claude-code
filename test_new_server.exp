#!/usr/bin/expect -f

set timeout 30
set server "154.12.24.166"
set username "root"
set password "weelYGED2077"

puts "连接到新服务器 $server..."

spawn ssh $username@$server
expect {
    "yes/no" {
        send "yes\r"
        exp_continue
    }
    "password:" {
        send "$password\r"
        expect "# "
    }
    "# " {
        puts "使用密钥认证成功连接"
    }
    timeout {
        puts "连接超时"
        exit 1
    }
}

# 检查基本系统信息
send "echo '=== 系统信息 ==='\r"
expect "# "

send "cat /etc/os-release | head -3\r"
expect "# "

send "echo '=== Web服务检查 ==='\r"
expect "# "

send "systemctl status nginx\r"
expect "# "

send "systemctl status apache2\r"
expect "# "

send "echo '=== 端口监听情况 ==='\r"
expect "# "

send "netstat -tlnp | grep ':80\|:443\|:8080\|:8088'\r"
expect "# "

send "echo '=== 宝塔面板检查 ==='\r"
expect "# "

send "bt version\r"
expect "# "

send "echo '=== Web目录检查 ==='\r"
expect "# "

send "ls -la /www/wwwroot/\r"
expect "# "

send "echo '=== 磁盘空间 ==='\r"
expect "# "

send "df -h\r"
expect "# "

puts "服务器检查完成"
send "exit\r"
expect eof 